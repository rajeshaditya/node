var express = require('express');var router = express.Router();var formidable = require('formidable');var path = require('path');var staffInfo = require('../models/staffinfo');var fs = require('fs');/* GET home page. */router.get('/', function(req, res, next) {  res.render('index', { title: 'Express' });});router.get('/login',function(req,res){  res.render('login');});//loginrouter.post('/login',function(req,res){  staffInfo.getUser(req.body.username,req.body.password,function(err,user){    if(!user){      res.render('login', { error: 'Invalid username or password.' });    }     else{        delete user.Password;        req.session.user = user;        res.redirect('/dashbord');      }  });});//LOGOUTrouter.get('/logout', function(req, res){  req.session.reset();  res.redirect('/login');});//dashboard after loginrouter.get('/dashbord',function(req,res){  if(req.session && req.session.user){    res.locals.user = req.session.user;    res.render('dashboard');  }  else{    req.session.reset();    res.redirect('login');  }});// mydatarouter.get('/mydata',function(req,res){  if (req.session && req.session.user){    res.locals.user = req.session.user;    res.render('mydata');  }  else    res.redirect('login');});router.get('/mycareer',function(req,res){  if (req.session && req.session.user) {    res.locals.user = req.session.user;    res.render('mycareer');  }  else    res.render('login');});router.post('/upload/:pr', function(req, res){  // create an incoming form object  var form = new formidable.IncomingForm();  // specify that we want to allow the user to upload multiple files in a single request  form.multiples = true;  // store all uploads in the /uploads directory    var db=req.db;  var stinfo =db.get('staffinfo');      if(req.params.pr== 1)    form.uploadDir = path.join(__dirname,'../public/uploads/bank');  else if(req.params.pr== 2)    form.uploadDir = path.join(__dirname,'../public/uploads/adhar');  else if(req.params.pr== 3)    form.uploadDir = path.join(__dirname,'../public/uploads/passport');  // every time a file has been uploaded successfully,  // rename it to it's orignal name  form.on('file', function(field, file) {    var fileType = file.name.split('.').pop();    var name=req.session.user._id+'.'+fileType;    fs.rename(file.path, path.join(form.uploadDir,name));    if(req.params.pr== 1){      var bank={"bank":"uploads/bank/"+name};      staffInfo.updateFile(req.session.user.PinNo,bank,function(err){        console.log(err);      });       }    else if(req.params.pr== 2){      var adhar={"adhar":"uploads/adhar/"+name};      staffInfo.updateFile(req.session.user.PinNo,adhar,function(err){        console.log(err);      });    }         else if(req.params.pr== 3){       var passport={"passport":"uploads/passport/"+name};      staffInfo.updateFile(req.session.user.PinNo,passport,function(err){        console.log(err);      });    }});      // log any errors that occur  form.on('error', function(err) {    console.log('An error has occured: \n' + err);  });  // once all the files have been uploaded, send a response to the client  form.on('end', function() {    res.end('success');  });  // parse the incoming request containing the form data  form.parse(req);});module.exports = router;